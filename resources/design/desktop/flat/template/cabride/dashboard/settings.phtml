<?php

use Cabride\Model\Cabride;
use Cabride\Form\Cabride as FormCabride;
use Siberian\Json;

$application = $this->getApplication();
$request = $this->getRequest();
$valueId = Cabride::getCurrentValueId();

$formSettings = new FormCabride();
$formSettings->setValueId($valueId);

$settings = (new Cabride())
    ->find($valueId, "value_id");
$settings = (new Cabride())->find($valueId, "value_id");
if (!$settings->getId()) {
    $settings->setValueId($valueId);
    $settings->save();
    $settings->reload();
}

if ($settings->getId()) {
    $settingsData = $settings->getData();

    $settingsData["payment_methods"] = $settings->getPaymentMethods();

    $formSettings->populate($settingsData);
}

?>
<div class="row">
    <div class="col-md-12">
        <div class="page-content-wrapper">
            <div id="settings_content"
                 class="content solo-page sb-tour">
                <h3 class="title-editor border-blue text-center">
                    <?php echo p__("cabride", "CabRide settings"); ?>
                </h3>
                <div class="subcontent content-color">
                    <div class="col-md-12">
                        <?php echo $formSettings ?>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    $(document).ready(function () {
        bindForms("#settings_content");

        let commissionType = $("#commission_type");

        commissionType.off("change");
        commissionType.on("change", function () {
            updateCommission();
        });

        let updateCommission = function () {
            let value = commissionType.val();
            switch (value) {
                case "disabled":
                    $("#commission").parents(".sb-form-line").hide();
                    $("#commission_fixed").parents(".sb-form-line").hide();
                    break;
                case "fixed":
                    $("#commission").parents(".sb-form-line").hide();
                    $("#commission_fixed").parents(".sb-form-line").show();
                    break;
                case "percentage":
                    $("#commission").parents(".sb-form-line").show();
                    $("#commission_fixed").parents(".sb-form-line").hide();
                    break;
                case "mixed":
                    $("#commission").parents(".sb-form-line").show();
                    $("#commission_fixed").parents(".sb-form-line").show();
                    break;
            }
        };

        updateCommission();
    });
</script>
<style type="text/css">
    #settings_content fieldset {
        border-left: 1px solid grey;
        margin-bottom: 15px;
    }

    #settings_content fieldset legend {
        margin-top: 0;
        margin-bottom: 0;
        text-transform: uppercase;
        font-weight: 100;
        letter-spacing: 0.05em;
        background: white;
        font-size: 18px;
        text-indent: 5px;
        border-left: 1px solid grey;
        margin-left: -1px;
        padding: 5px;
    }

    #settings_content fieldset dl {
        padding: 15px;
        margin-bottom: 0;
        padding-bottom: 0;
    }

    .sb-check-container label {
        display: block;
    }

    .sb-check-container label > span {
        display: inline-block;
        padding-left: 6px;
        transform: translateY(-3px);
        letter-spacing: 1px;
    }

    .sb-check-container label span.pm-enabled {
        color: #438013;
    }
    .sb-check-container label span.pm-disabled {
        color: #bd1509;
    }
</style>